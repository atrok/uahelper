<!doctype html>
<html lang="en">

<head>
	<title>Support Architect Tools</title>
	<!-- meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" -->
	<link rel="stylesheet" href="/assets/css/main.css">
	<link href="https://fonts.googleapis.com/css?family=Lato:100,200" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="/assets/css/loading-bar.css" />
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	 crossorigin="anonymous">

</head>

<body>

	<section class='screen'>


		<div class="page_name">
			<p class="huge">Upgrade Advisory tool</p>
		</div>
		 
    <div class="header_menu">
        <ul class="horiz_menu">
            <li>
                <a href="/prepareadvisory" >Upgrade Advisory</a>
            </li>
            <li>
                <a href="/topologybuilder" >Topology builder</a>
            </li>
            <li>
                <a href="/compareconfig" >Configuration Comparison tool</a>
            </li>
        </ul>
    </div>


		<div class="w3-bar w3-black">

			<button class="w3-bar-item w3-button  tablink w3-red" onclick="openTab(event, 'db')">Database</button>
			<button class="w3-bar-item w3-button  tablink" onclick="openTab(event, 'app')">Application</button>
			<button class="w3-bar-item w3-button  tablink" onclick="openTab(event, 'csv')">File</button>
			<button class="w3-bar-item w3-button  tablink" onclick="openTab(event, 'lists')">Saved configurations</button>
			<button class="w3-bar-item w3-button  tablink" onclick="openTab(event, 'options')">Settings</button>
			<button class="w3-bar-item w3-button  tablink" onclick="openTab(event, 'admin')">Views management</button>

		</div>
		<div id="forms" class="left">
			<div id="db" class='tab height300'>
				<form id="form_dbs" class="appnitro">



					<h1>Enter DB connection details</h1>
					<ul>

						<li id="li_dbtype">
							<label class="description" for="element_1">DBMS type</label>
							<div>
								<select class="dropdown_select">
									<option value='oracle' selected>Oracle</option>
									<option value='mssql'>MSSQL</option>
								</select>
							</div>
						</li>

						<li id="li_host">
							<label class="description" for="element_2">Host</label>
							<div>
								<input id="host" name="host" class="element text medium" type="text" size="25" maxlength="255" value='' />
							</div>
						</li>
						<li id="li_dbname">
							<label class="description" for="element_3">Database name(Mssql)/Schema Name(Oracle)</label>
							<div>
								<input id="dbname" name="dbname" class="element text medium" type="text" size="25" maxlength="255" value="" />
							</div>
						</li>
						<li id="li_user">
							<label class="description" for="element_4">Username</label>
							<div>
								<input id="user" name="user" class="element text medium" type="text" size="25" maxlength="255" value="" />
							</div>
						</li>
						<li id="li_pass">
							<label class="description" for="element_5">Password</label>
							<div>
								<input id="pass" name="pass" class="element text medium" type="password" size="25" maxlength="255" value="" />
							</div>
						</li>

						<li id="li_3">

							<li class="buttons">
								<input type="hidden" name="form_id" value="68250" />

								<button>Connect</button>
							</li>
					</ul>

				</form>
			</div>

			<div id="app" class="tab height300" style="display:none">
				<form id="form_comp">
					<h1>Select component</h1>
					<ul>
						<li>
							<label class="description" for="element_0">Solution</label>
							<div class="dropdown">
								<select id="solution" class="dropdown_select">

								</select>
							</div>
						</li>
						<li>
							<label class="description" for="element_1">Component</label>
							<div class="dropdown">
								<select id="application_type" class="dropdown_select">
									<option size="25" value='.NET Web API Server and Samples'>.NET Web API Server and Samples</option>
									<option size="25" value='Aastra MXONE CSTA I'>Aastra MXONE CSTA I</option>
									<option size="25" value='Administration Console'>Administration Console</option>
									<option size="25" value='Alcatel A4400/OXE'>Alcatel A4400/OXE</option>
									<option size="25" value='API'>API</option>
									<option size="25" value='Aspect ACD'>Aspect ACD</option>
									<option size="25" value='Authoring Tool'>Authoring Tool</option>
									<option size="25" value='Avaya Communication Manager'>Avaya Communication Manager</option>
									<option size="25" value='Avaya TSAPI'>Avaya TSAPI</option>
									<option size="25" value='Backend'>Backend</option>
									<option size="25" value='Builder'>Builder</option>
									<option size="25" value='Business Process for use with Facebook'>Business Process for use with Facebook</option>
									<option size="25" value='Business Process for use with RSS'>Business Process for use with RSS</option>
									<option size="25" value='Business Process for use with Twitter'>Business Process for use with Twitter</option>
									<option size="25" value='Call Control Platform'>Call Control Platform</option>
									<option size="25" value='Call Progress Detection Server'>Call Progress Detection Server</option>
									<option size="25" value='CCPulse+'>CCPulse+</option>
									<option size="25" value='Chat Server'>Chat Server</option>
									<option size="25" value='Cisco Adapter'>Cisco Adapter</option>
									<option size="25" value='Classification Server'>Classification Server</option>
									<option size="25" value='CMS'>CMS</option>
									<option size="25" value='Configuration Database Maintenance Scripts'>Configuration Database Maintenance Scripts</option>
									<option size="25" value='Configuration Manager'>Configuration Manager</option>
									<option size="25" value='Configuration Server'>Configuration Server</option>
									<option size="25" value='Configuration Utility'>Configuration Utility</option>
									<option size="25" value='Contact Center Advisor - Mobile Edition'>Contact Center Advisor - Mobile Edition</option>
									<option size="25" value='Contact Center Advisor - Mobile Edition Android Client'>Contact Center Advisor - Mobile Edition Android Client</option>
									<option size="25" value='Contact Center Advisor - Mobile Edition Blackberry Client'>Contact Center Advisor - Mobile Edition Blackberry Client</option>
									<option size="25" value='Contact Center Advisor - Mobile Edition iOS Client'>Contact Center Advisor - Mobile Edition iOS Client</option>
									<option size="25" value='Contact Center Advisor &amp; Workforce Advisor'>Contact Center Advisor &amp; Workforce Advisor</option>
									<option size="25" value='Content Analyzer Plug-in for GAX'>Content Analyzer Plug-in for GAX</option>
									<option size="25" value='CSTA Connector'>CSTA Connector</option>
									<option size="25" value='CSTA Connector for BroadSoft BroadWorks'>CSTA Connector for BroadSoft BroadWorks</option>
									<option size="25" value='CTI Connector'>CTI Connector</option>
									<option size="25" value='Custom Server'>Custom Server</option>
									<option size="25" value='Daemon'>Daemon</option>
									<option size="25" value='Data Aggregator'>Data Aggregator</option>
									<option size="25" value='Data Mart'>Data Mart</option>
									<option size="25" value='Data Modeling Assistant'>Data Modeling Assistant</option>
									<option size="25" value='Data Sourcer'>Data Sourcer</option>
									<option size="25" value='Database Utility'>Database Utility</option>
									<option size="25" value='DB Server'>DB Server</option>
									<option size="25" value='Development Tool'>Development Tool</option>
									<option size="25" value='Device Management Plug-in for Genesys Administrator Extension'>Device Management Plug-in for Genesys Administrator Extension</option>
									<option size="25" value='E-mail Server'>E-mail Server</option>
									<option size="25" value='EADS Intecom M6880'>EADS Intecom M6880</option>
									<option size="25" value='Engine'>Engine</option>
									<option size="25" value='eServices Manager Plug-in for GAX'>eServices Manager Plug-in for GAX</option>
									<option size="25" value='Fetching Module'>Fetching Module</option>
									<option size="25" value='Frontend'>Frontend</option>
									<option size="25" value='Frontline Advisor and Agent Advisor'>Frontline Advisor and Agent Advisor</option>
									<option size="25" value='Genesys Adapter'>Genesys Adapter</option>
									<option size="25" value='Genesys Administrator'>Genesys Administrator</option>
									<option size="25" value='Genesys Administrator Extension'>Genesys Administrator Extension</option>
									<option size="25" value='Genesys Administrator Extension HPE SPD'>Genesys Administrator Extension HPE SPD</option>
									<option size="25" value='Genesys Agent Scripting'>Genesys Agent Scripting</option>
									<option size="25" value='Genesys Care Workbench Agent'>Genesys Care Workbench Agent</option>
									<option size="25" value='Genesys Care Workbench Log Extractor'>Genesys Care Workbench Log Extractor</option>
									<option size="25" value='Genesys Care Workbench Server'>Genesys Care Workbench Server</option>
									<option size="25" value='Genesys Cloud API Driver for  Facebook'>Genesys Cloud API Driver for  Facebook</option>
									<option size="25" value='Genesys Cloud API Driver for  Twitter'>Genesys Cloud API Driver for  Twitter</option>
									<option size="25" value='Genesys Co-browse Server'>Genesys Co-browse Server</option>
									<option size="25" value='Genesys Data Processing Server'>Genesys Data Processing Server</option>
									<option size="25" value='Genesys Driver for Use with Facebook'>Genesys Driver for Use with Facebook</option>
									<option size="25" value='Genesys Driver for Use with RSS'>Genesys Driver for Use with RSS</option>
									<option size="25" value='Genesys Driver for Use with Twitter'>Genesys Driver for Use with Twitter</option>
									<option size="25" value='Genesys Info Mart'>Genesys Info Mart</option>
									<option size="25" value='Genesys Info Mart Manager'>Genesys Info Mart Manager</option>
									<option size="25" value='Genesys Interactive Insights'>Genesys Interactive Insights</option>
									<option size="25" value='Genesys Mobile Services'>Genesys Mobile Services</option>
									<option size="25" value='Genesys One Base Pack'>Genesys One Base Pack</option>
									<option size="25" value='Genesys One Email Pack'>Genesys One Email Pack</option>
									<option size="25" value='Genesys One HA Pack'>Genesys One HA Pack</option>
									<option size="25" value='Genesys Pulse'>Genesys Pulse</option>
									<option size="25" value='Genesys Pulse Collector'>Genesys Pulse Collector</option>
									<option size="25" value='Genesys Quality Management'>Genesys Quality Management</option>
									<option size="25" value='Genesys SIP Voicemail'>Genesys SIP Voicemail</option>
									<option size="25" value='Genesys SIP Voicemail Complete Install'>Genesys SIP Voicemail Complete Install</option>
									<option size="25" value='Genesys Softphone'>Genesys Softphone</option>
									<option size="25" value='Genesys SR Service'>Genesys SR Service</option>
									<option size="25" value='Genesys T-Server and UCMA Connector for Skype for Business'>Genesys T-Server and UCMA Connector for Skype for Business</option>
									<option size="25" value='Hosted Provider Edition'>Hosted Provider Edition</option>
									<option size="25" value='Hosted Provider Edition Agent Desktop Proxy'>Hosted Provider Edition Agent Desktop Proxy</option>
									<option size="25" value='Interaction Recording Web Services'>Interaction Recording Web Services</option>
									<option size="25" value='Interaction Routing Designer'>Interaction Routing Designer</option>
									<option size="25" value='Interaction Server'>Interaction Server</option>
									<option size="25" value='Interaction Server Cluster Plug-in for GAX'>Interaction Server Cluster Plug-in for GAX</option>
									<option size="25" value='Interaction Server Proxy'>Interaction Server Proxy</option>
									<option size="25" value='Interaction Workflow Samples'>Interaction Workflow Samples</option>
									<option size="25" value='Interaction Workspace'>Interaction Workspace</option>
									<option size="25" value='Interaction Workspace Plug-in for Facebook'>Interaction Workspace Plug-in for Facebook</option>
									<option size="25" value='Interaction Workspace Plug-in for Genesys Agent Scripting'>Interaction Workspace Plug-in for Genesys Agent Scripting</option>
									<option size="25" value='Interaction Workspace Plug-in for RSS'>Interaction Workspace Plug-in for RSS</option>
									<option size="25" value='Interaction Workspace Plug-in for Twitter'>Interaction Workspace Plug-in for Twitter</option>
									<option size="25" value='IVR Driver for MPS'>IVR Driver for MPS</option>
									<option size="25" value='IVR Driver for WVR for AIX'>IVR Driver for WVR for AIX</option>
									<option size="25" value='IVR Library'>IVR Library</option>
									<option size="25" value='IVR SDK'>IVR SDK</option>
									<option size="25" value='IVR Server'>IVR Server</option>
									<option size="25" value='iWD Data Mart'>iWD Data Mart</option>
									<option size="25" value='iWD GAX Plug-In'>iWD GAX Plug-In</option>
									<option size="25" value='iWD Manager'>iWD Manager</option>
									<option size="25" value='iWD Runtime Node'>iWD Runtime Node</option>
									<option size="25" value='iWD Setup Utility'>iWD Setup Utility</option>
									<option size="25" value='iWD Stat Server Extensions'>iWD Stat Server Extensions</option>
									<option size="25" value='iWD Web'>iWD Web</option>
									<option size="25" value='Java Environment and Libraries for eServices and UCS'>Java Environment and Libraries for eServices and UCS</option>
									<option size="25" value='Knowledge Manager'>Knowledge Manager</option>
									<option size="25" value='License Reporting Manager'>License Reporting Manager</option>
									<option size="25" value='Load Distribution Server'>Load Distribution Server</option>
									<option size="25" value='Local Control Agent'>Local Control Agent</option>
									<option size="25" value='Log File Management Tool Client'>Log File Management Tool Client</option>
									<option size="25" value='Log File Management Tool Collector'>Log File Management Tool Collector</option>
									<option size="25" value='Log File Management Tool Indexer'>Log File Management Tool Indexer</option>
									<option size="25" value='Manager'>Manager</option>
									<option size="25" value='Media Control Platform'>Media Control Platform</option>
									<option size="25" value='Message Server'>Message Server</option>
									<option size="25" value='MIB'>MIB</option>
									<option size="25" value='Mitel MiTAI'>Mitel MiTAI</option>
									<option size="25" value='Mitel MiVoice'>Mitel MiVoice</option>
									<option size="25" value='MRCP Proxy'>MRCP Proxy</option>
									<option size="25" value='Multi-Channel Routing Extensions'>Multi-Channel Routing Extensions</option>
									<option size="25" value='NEC NEAX/APEX'>NEC NEAX/APEX</option>
									<option size="25" value='Nortel Communication Server 1000 with SCCS/MLS'>Nortel Communication Server 1000 with SCCS/MLS</option>
									<option size="25" value='Nortel Communication Server 2000/2100'>Nortel Communication Server 2000/2100</option>
									<option size="25" value='Orchestration Server'>Orchestration Server</option>
									<option size="25" value='Outbound Contact Center Extension'>Outbound Contact Center Extension</option>
									<option size="25" value='Outbound Contact Server'>Outbound Contact Server</option>
									<option size="25" value='Platform'>Platform</option>
									<option size="25" value='Platform SDK &amp; Application Blocks for .NET'>Platform SDK &amp; Application Blocks for .NET</option>
									<option size="25" value='Platform SDK &amp; Application Blocks for Java'>Platform SDK &amp; Application Blocks for Java</option>
									<option size="25" value='Platform SDK for .NET'>Platform SDK for .NET</option>
									<option size="25" value='Platform SDK for Java'>Platform SDK for Java</option>
									<option size="25" value='Plug-in for GAX'>Plug-in for GAX</option>
									<option size="25" value='Plug-in for Genesys Administrator Extension'>Plug-in for Genesys Administrator Extension</option>
									<option size="25" value='Plug-in for Interaction Workspace'>Plug-in for Interaction Workspace</option>
									<option size="25" value='Plug-in for Workspace Desktop Edition'>Plug-in for Workspace Desktop Edition</option>
									<option size="25" value='Plugin for Administrator'>Plugin for Administrator</option>
									<option size="25" value='Plugin for Genesys Administrator Extension'>Plugin for Genesys Administrator Extension</option>
									<option size="25" value='Plugin for Workspace Desktop Edition'>Plugin for Workspace Desktop Edition</option>
									<option size="25" value='Policy Server'>Policy Server</option>
									<option size="25" value='Privacy Manager Plugin for GAX'>Privacy Manager Plugin for GAX</option>
									<option size="25" value='PSTN Connector'>PSTN Connector</option>
									<option size="25" value='Recording Crypto Server'>Recording Crypto Server</option>
									<option size="25" value='Recording Muxer Script'>Recording Muxer Script</option>
									<option size="25" value='Recording Plug-in for Genesys Administrator Extension'>Recording Plug-in for Genesys Administrator Extension</option>
									<option size="25" value='Recording Processor Script'>Recording Processor Script</option>
									<option size="25" value='Reporting and Analytics Aggregates'>Reporting and Analytics Aggregates</option>
									<option size="25" value='Reporting Dashboard Proxy for Genesys Administrator Extension'>Reporting Dashboard Proxy for Genesys Administrator Extension</option>
									<option size="25" value='Reporting Plug-in for GAX'>Reporting Plug-in for GAX</option>
									<option size="25" value='Reporting Server'>Reporting Server</option>
									<option size="25" value='Resource Manager'>Resource Manager</option>
									<option size="25" value='Sample Reporting Templates'>Sample Reporting Templates</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Client 3.1.x'>SAP BusinessObjects Business Intelligence Platform Client 3.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Client 4.1.x'>SAP BusinessObjects Business Intelligence Platform Client 4.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Client ServicePack 3.1.x'>SAP BusinessObjects Business Intelligence Platform Client ServicePack 3.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Client ServicePack 4.1.x'>SAP BusinessObjects Business Intelligence Platform Client ServicePack 4.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Server 3.1.x'>SAP BusinessObjects Business Intelligence Platform Server 3.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Server 4.1.x'>SAP BusinessObjects Business Intelligence Platform Server 4.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Server Service Pack 3.1.x'>SAP BusinessObjects Business Intelligence Platform Server Service Pack 3.1.x</option>
									<option size="25" value='SAP BusinessObjects Business Intelligence Platform Server ServicePack 4.1.x'>SAP BusinessObjects Business Intelligence Platform Server ServicePack 4.1.x</option>
									<option size="25" value='Security Pack on UNIX'>Security Pack on UNIX</option>
									<option size="25" value='Server'>Server</option>
									<option size="25" value='Siemens HiPath 4000 CSTA III'>Siemens HiPath 4000 CSTA III</option>
									<option size="25" value='SIP Endpoint SDK for .NET'>SIP Endpoint SDK for .NET</option>
									<option size="25" value='SIP Endpoint SDK for Apple OS'>SIP Endpoint SDK for Apple OS</option>
									<option size="25" value='SIP Feature Server'>SIP Feature Server</option>
									<option size="25" value='SIP Proxy'>SIP Proxy</option>
									<option size="25" value='SIP Server'>SIP Server</option>
									<option size="25" value='sipspan2'>sipspan2</option>
									<option size="25" value='SMS Server'>SMS Server</option>
									<option size="25" value='SNMP Master Agent'>SNMP Master Agent</option>
									<option size="25" value='Social Media Plug-in for Workspace Desktop Edition'>Social Media Plug-in for Workspace Desktop Edition</option>
									<option size="25" value='Social Messaging Plugin for Genesys Agent Desktop'>Social Messaging Plugin for Genesys Agent Desktop</option>
									<option size="25" value='Social Messaging Server'>Social Messaging Server</option>
									<option size="25" value='Solution Control Server'>Solution Control Server</option>
									<option size="25" value='Spectrum'>Spectrum</option>
									<option size="25" value='Stat Server'>Stat Server</option>
									<option size="25" value='Supplementary Services Gateway'>Supplementary Services Gateway</option>
									<option size="25" value='T-Server Common Part'>T-Server Common Part</option>
									<option size="25" value='T-Server-CUCM to Media Server Connector'>T-Server-CUCM to Media Server Connector</option>
									<option size="25" value='Third-Party Squid'>Third-Party Squid</option>
									<option size="25" value='Training Server'>Training Server</option>
									<option size="25" value='UCS Manager'>UCS Manager</option>
									<option size="25" value='Universal Contact Server'>Universal Contact Server</option>
									<option size="25" value='Universal Contact Server Manager'>Universal Contact Server Manager</option>
									<option size="25" value='Universal Contact Server Proxy'>Universal Contact Server Proxy</option>
									<option size="25" value='Universal Routing Server'>Universal Routing Server</option>
									<option size="25" value='VP Reporting Plugin for GAX'>VP Reporting Plugin for GAX</option>
									<option size="25" value='Web'>Web</option>
									<option size="25" value='Web API Server'>Web API Server</option>
									<option size="25" value='Web API Server for WebLogic'>Web API Server for WebLogic</option>
									<option size="25" value='Web API Server for WebSphere'>Web API Server for WebSphere</option>
									<option size="25" value='Web Services and Applications'>Web Services and Applications</option>
									<option size="25" value='Widgets'>Widgets</option>
									<option size="25" value='Workspace Desktop Edition'>Workspace Desktop Edition</option>
									<option size="25" value='Workspace Plugin for Skype for Business'>Workspace Plugin for Skype for Business</option>
								</select>
							</div>
						</li>

						<li>
							<label class="description" for="element_1">Version</label>
							<div>
								<input id="release" name="release" class="element text medium" type="text" size="25" maxlength="255" value="" />
							</div>
						</li>
						<li>
							<label class="description" for="element_1">OS type</label>
							<div class="dropdown">
								<select id="os_type" class="dropdown_select">
									<option value='solaris'>Solaris</option>
									<option value='solaris'>Solaris x86</option>
									<option value='trux'>Tru64 Unix</option>
									<option value='hpux'>HP-UX</option>
									<option value='aix'>IBM AIX</option>
									<option value='sunos'>SunOS</option>
									<option value='windows'>Windows NT</option>
									<option value='windows'>Windows</option>
									<option value='ibmos2'>IBM OS2</option>
									<option value='macintosh'>Macintosh</option>
									<option value='tandemux'>Tandem UNIX</option>
									<option value='uxware'>UNIX Ware</option>
									<option value='windows'>Windows 2000</option>
									<option value='windows'>Windows XP</option>
									<option value='windows'>Windows Server 2003</option>
									<option value='linux'>RedHat Enterprise Linux AS/Intel</option>
									<option value='windows'>Windows Server 2008</option>
									<option value='windows'>Windows Vista</option>
									<option value='windows'>Windows Server 2012</option>
								</select>
							</div>
						</li>

						<li>

							<div>
								<button class="btn btn-primary">Search</button>
								<button type="button" class="btn btn-primary" id="addto-cs-event">Add item to configuration list</button>
							</div>
						</li>
				</form>
			</div>

			<div id="csv" class="tab height300" style="display:none">
				<form id="form_csv">
					<h1>Upload CSV file with component versions</h1>
					<ul>

						<li>

							<div>
								<input id="uploadInput" type="file" name="myFiles" onchange="handleFiles(event);">
							</div>
						</li>
				</form>
			</div>

			<div id="lists" class="tab height300" style="display:none">
				<form id="form_lists">
					<h1>Load components from saved configuration</h1>
					<p>Create configuration lists either from Application tab or by uploading csv file with list of components</p>
					<ul>
						<li>
							<label class="description" for="element_0">Saved configurations</label>
							<div class="dropdown">
								<select id="configlist" class="dropdown_select">
									<option value="">Select One …</option>
								</select>
							</div>
						</li>

				</form>
			</div>

			<div id="options" class="tab height300" style="display:none">

				<h1></h1>
				
				<div class="form-check">
					<input type="checkbox" class="form-check-input" id="genfile">
					<label class="form-check-label" for="exampleCheck1">Generate file on server</label>
				</div>

				<div class="form-check">
					<input type="checkbox" class="form-check-input" id="save_task">
					<label class="form-check-label" for="exampleCheck1">Save tasks to task list</label>
				</div>
			</div>

			<div id="admin" class="tab height300" style="display:none">
				<form id="form_admin">
					<h1>Choose Database to recreate views</h1>
					<ul>

						<li>
							<label class="description" for="element_1">Databases</label>
							<div class="dropdown">
								<select id="databases" class="dropdown_select">
									<option size="25" value='genesys_releases'>genesys_releases</option>
								</select>
							</div>
						</li>

						<li>

							<div>
								<button>Run</button>
							</div>
						</li>
				</form>
			</div>

		</div>

		<div class='content left'>

			<div id='div_result'>
				
<!--div class="ldBar" data-value=""></div -->


<div>
    
    <div id='loadBar'>
    <div id="loadBar-background"></div>
        <div id="loadBar-inner">
            <div id="myItem1" ></div>
        </div>
        </div>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#conflist_tab" aria-expanded="false">Configuration Lists</a>
        </li>
        <li class>
            <a href="#result_tab" aria-expanded="false">Results</a>
        </li>
        <li class>
            <a href="#tasks_tab" aria-expanded="false">Tasks</a>
        </li>
        <li class>
            <a href="#console_tab" aria-expanded="false">Console</a>
        </li>
                <li class>
            <a href="#stat_tab" aria-expanded="false">Statistics</a>
        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="conflist_tab">
            <div id="configlist_container">
                <h1>Configuration list </h1>
                <p>
                    Add components into the configuration list to save it and use for later.
                </p>
                <ul>
                    <li>Name:
                        <span id="configlist_name"></span>
                    </li>
                    <li>_id:
                        <span id="configlist_docid"></span>
                    </li>
                    <li>_rev:
                        <span id="configlist_revid"></span>
                    </li>
                    <li>Creation time:
                        <span id="configlist_time"></span>
                    </li>
                    <li>Updated time:
                        <span id="configlist_updated"></span>
                    </li>
                </ul>



                <div id="config_list" class="table-editable" style="visibility: hidden">
                    <span class="table-add glyphicon glyphicon-plus"></span>
                    <table id="config_list_t" class="table">
                        <tr id="config_list_t_header">
                        </tr>
                        <!-- This is our clonable table line -->
                        <!-- This is our clonable table line -->
                        <tr class="hide">
                            <td contenteditable="true">Untitled</td>
                            <td contenteditable="true">undefined</td>
                            <td>
                                <span class="table-remove glyphicon glyphicon-remove"></span>
                            </td>
                            <td>
                                <span class="table-up glyphicon glyphicon-arrow-up"></span>
                                <span class="table-down glyphicon glyphicon-arrow-down"></span>
                            </td>
                        </tr>

                    </table>
                </div>

                <div class="modal fade" id="configlist_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Save configuration list</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="configlist-name" class="col-form-label">Enter configuration list name:</label>
                                        <input type="text" class="form-control" id="configlist-name">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="save-event">Save configuration list</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="configlist_update_modal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Updating configuration list</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Configuration list has been changed, do you want to save it?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="update-event">Update</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="configlist_delete_modal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Deleting configuration list</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Please confirm deletion of configuration list</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="delete-event">Delete</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="configlist_forced_update_modal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Warning! Configuration list is not saved</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>There are unsaved changes in configuration list. Do you want to save them before resetting to a new
                            configuration list?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="forced-update-event">Save</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="reset-event">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div role="tabpanel" class="tab-pane" id="result_tab">
            <form id="form_generate">
                <div id="result">

                </div>
                <div id="generate" style="visibility: hidden">
                    <label>Generate report:</label>
                    <!--button id='docx'>Docx</button -->
                    <!-- button id='xlsx'>Xlsx</button -->

                </div>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane" id="tasks_tab">
            <div id="tasksContainer">
                <h3>Executed tasks</h3>
                <form id="form_tasks">
                    <table id="tasks" class="table">
                        <tr>
                            <th>Delete</th>
                            <th>Time</th>
                            <th>Arguments</th>
                            <th>ID</th>
                        </tr>
                    </table>
                    <div>
                        <button>Delete</button>
                    </div>
                </form>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="stat_tab">
            <div id="statContainer">
                <h3>Summary overview of release notes per solution, component, os type and family</h3>

                <p>
                    <button type="button" class="btn btn-primary" id="get-statdata-event">Pull statistics</button>
                </p>
                <div id="dbinfo" class="table-editable" style="visibility: hidden"></div>
                <div id="stat_data" class="table-editable" style="visibility: hidden">
                    
                    <table id="stat_data_t" class="table">
                        <tr id="stat_data_t_header">
                        </tr>
                        <!-- This is our clonable table line -->
                        <!-- This is our clonable table line -->
                        <tr class="hide">
                            <td contenteditable="true">Untitled</td>
                            <td contenteditable="true">undefined</td>
                            <td>
                                <span class="table-remove glyphicon glyphicon-remove"></span>
                            </td>
                            <td>
                                <span class="table-up glyphicon glyphicon-arrow-up"></span>
                                <span class="table-down glyphicon glyphicon-arrow-down"></span>
                            </td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="console_tab">
            <div id="console"></div>
        </div>
    </div>

</div> <script src="/assets/js/socket.io.js "></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="/assets/js/loading-bar.min.js"></script>
<script src="/assets/js/docxtemplater-latest.min.js"></script>
<script src="/assets/js/jszip.min.js"></script>
<script src="/assets/js/file-saver.min.js"></script>
<script src="/assets/js/jszip-utils.js"></script>
<script src="/assets/js/LineReader.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<!-- script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<!--
    Mandatory in IE 6, 7, 8 and 9.
    -->
<!--[if IE]>
        <script type="text/javascript" src="examples/vendor/jszip-utils-ie.js"></script>
    <![endif]-->
<script>



    // function to hide and show progress bar and other elements
    (function ($) {
        $.fn.invisible = function () {
            return this.css("visibility", "hidden");
        };
        $.fn.visible = function () {
            return this.css("visibility", "visible");
        };
    })(jQuery);




    var obj = [];
    var components = {
        file: {
            name: '',
            size: 0,
            mimeType: ''
        },
        components: []
    };

    var socket = io.connect('/prepareadvisory');

    var bar1 = new ldBar("#myItem1", {
        "preset": "stripe"
    });
    //var bar2 = document.getElementById('myItem1').ldBar;

    var id;


    socket.on('connected', function (data) {
        console.log(data);
        id = data.id;
        socket.emit('tasks', {});
        socket.emit('get_solutions', {});
        socket.emit('get_all_configlists', {});
        socket.emit('get_dbinfo', {});
    });

    socket.on('solutions', function (data) { //populate solutions dropdown list

        if (data) {
            console.log(data);
            $("#solution").append("<option value=''>Select One …</option>");
            Object.keys(data).forEach((key) => {
                $("#solution").append("<option size=25 value='" + data[key].key + "'>" + data[key].key + "</option>");
            });
        }
        // attaching event listeners to process generate document requests;

        $(document).ready(function () {
            solutions = document.getElementById("solution");
            document.getElementById("solution").addEventListener("change", function () {

                solutions.options[solutions.options.selectedIndex].selected = true;
                socket.emit('get_components', $("#solution option:selected").attr("value"));

                return false;

            });
        });
    })

    socket.on('components', function (data) {
        console.log(data);
        if (data) {
            removeOptions(document.getElementById("application_type"))
            Object.keys(data).forEach((key) => {
                $("#application_type").append("<option size=25 value='" + data[key].key[1] + "'>" + data[key].key[1] + "</option>");
            });

            // since we add options dynamically we need to set selected flag on change event
            $(document).ready(function () {
                applications = document.getElementById("application_type");
                document.getElementById("application_type").addEventListener("change", function () {

                    applications.options[applications.options.selectedIndex].selected = true;
                    return false;

                });
            });
        }
    })

    socket.on('all_configlists', function (data) {
        console.log(data);
        if (data) {
            removeOptions(document.getElementById("configlist"));
            $("#configlist").append("<option value=''>Select One …</option>");
            Object.keys(data).forEach((key) => {
                $("#configlist").append("<option size=25 id='#" + data[key].id + "' value='" + data[key].id + "'>" + data[key].doc.cfglist_name + "</option>");
                //$('#'+data[key].id).data("components",data[key].doc.components);
            });

            // since we add options dynamically we need to set selected flag on change event
            $(document).ready(function () {
                configlist = document.getElementById("configlist");
                document.getElementById("configlist").addEventListener("change", function () {

                    configlist.options[configlist.options.selectedIndex].selected = true;

                    var doc_id = configlist.options[configlist.options.selectedIndex].value;
                    submitData('get_configlist', doc_id);
                    $('.nav-tabs a#conflist_tab').tab('show');
                })
                return false;

            });
        }
    })

    socket.on('configlist', function (data) {
        console.log('configlist received:' + JSON.stringify(data));
        if (data) {
            //removeOptions(document.getElementById("configlist"))

            // since we add options dynamically we need to set selected flag on change event
            var components = data.components;

            configlist_detach();

            add_config_list_item(components);

            $('.nav-tabs a[href="#conflist_tab"]').tab('show');
            // initialize config list buttons
            $(document).ready(function () {
                init_config_lists_caption(data);
                init_config_lists();

                // TODO:
                // add listeners for editable cells change events
                editable_setlisteners()
            });

            $("#config_list").visible();

        }
    })

    function editable_setlisteners() {
        $('body').on('focus', '[contenteditable]', function () {
            var $this = $(this);
            $this.data('before', $this.html());
            return $this;
        }).on('blur keyup paste input', '[contenteditable]', function () {
            var $this = $(this);
            if ($this.data('before') !== $this.html()) {
                $this.data('before', $this.html());
                $this.trigger('cl_editable_change');
            }
            return $this;
        }).on('cl_editable_change', function () {
            var $this = $(this)
            console.log($this + " triggered cl_editable_change")
            button_enable($("#update-btn"))
        });
    }

    function add_config_list_item(arr) {


        arr.forEach(function (item, i) {
            var header = ["SOLUTION","APPLICATION_TYPE","OS","OS_TYPE","RELEASE"];

            var head = $("#config_list_t").find('th:not(:empty)')
            if (head.length == 0) {
                /*
                Object.keys(item).forEach((key) => {
                    header.push(key);
                });
*/
                add_header_to_configlist(header); // add predefined header
                console.log("config list header is created");
                //init_config_lists();

            }
            var row = []
            /*
            Object.values(item).forEach((value) => {
                row.push(value);
            })
            */
            header.forEach(function(ind,i){
                let val=item[ind] || item[ind.toLowerCase()] || "";
                row[i]=val;

            })
            add_row_to_configlist(row);
            console.log("config list rows are added");
        })
    }


    socket.on('statdata', function (data) {
        console.log(data);
        if (data) {

            $("#stat_data").empty();

            Object.keys(data).forEach((key) => {
                if (key === 'file' || key === 'error' || key == 'table') // 
                    $("#stat_data").append(data[key]);
            })

            // placeholder
            $(document).ready(function () {

            });

            $("#stat_data").visible();

        }
    })

    socket.on('progress', function (data) {
        console.log(data.percents);
        bar1.set(data.percents);
    })

    socket.on('result', function (data) {
        console.log(data);
        $("#generate").visible();
        $("#div_result #resultsTable").empty();

        // remove all hidden inputs
        var fields = $("#form_generate :input").serializeArray();
        $.each(fields, function (i, field) {
            $("input[name='" + field.value + "']").remove();
        });

        // clearing the cache
        obj = [];

        // saving object for postprocesing in cache
        if (data.parsed_obj) {
            obj[data._id] = data.parsed_obj;
            $("#generate").append("<input type='hidden' name='" + data._id + "' value='" + data._id + "' />");
        }

        Object.keys(data).forEach((key) => {
            if (key === 'file' || key === 'error' || key == 'table') // 
                $("#div_result #result").append(data[key]);
        })



        $('.tableresultheader').click(function () {
            $header = $(this);
            $content = $header.next();
            $content.slideToggle(500, function () {
                $header.text(function () {
                    return $content.is(':visible') ? 'Collapse' : 'Expand';
                });
            });
        });

        // attaching event listeners to process generate document requests;
        $("#generate #docx").detach();
        $("#generate").append('<button id="docx" class="btn btn-primary">Generate Docx</button>');

        $(document).ready(function () {

            var init_form_fields = function () {

                var values = {};
                var fields = $("#form_generate :input").serializeArray();
                $.each(fields, function (i, field) {
                    values = obj[field.value];
                });

                var generator = new Generator();

                generator.generateDocx("/assets/js/input.docx", values);

                return false;

            };


            //document.getElementById("docx").removeEventListener("click", init_form_fields,true);
            document.getElementById("docx").addEventListener("click", init_form_fields, true);



        });

        $('.nav-tabs a[href="#result_tab"]').tab('show');


    })

    socket.on('console', function (data) {
        console.log(data);
        //$("#div_result").empty();
        Object.keys(data).forEach((key) => { $("#div_result #console").append(data[key]); })


    })

    socket.on('errors', function (data) {
        console.log(data);
        //$("#div_result").empty();
        lotsoferrors(data);


    })

    socket.on('dbinfo', function (data) {
        console.log(data);
        $("#dbinfo").empty();
        $("#dbinfo").append(data.table);
        $("#dbinfo").visible();




    })

    socket.on('done', function (data) {
        done();
    })

    socket.on('validation', function (data) {
        console.log(data);
        // $(':submit').attr('disabled', 'disabled');
        if (data.submitted) {
            $("#div_result #console").append(data.reason);
        } else {
            lotsoferrors(data.reason)
            done();
        }
    })

    socket.on('tasks', function (data) {
        console.log('Got list of tasks');
        if (data instanceof Array) {
            data.forEach((item) => {
                $('#tasks').append(
                    '<tr id="' + item._id + '">'
                    + '<td><input type="checkbox" id="' + item._id + '" /></td>'
                    + '<td>' + item.time.toString() + '</td>'
                    + '<td>' + item.input.toString() + '</td>'
                    + '<td>' + item.link.toString() + '</td>'
                    + '</tr>'
                )
            })
            $(document).ready(function () {
                $(".getresult").click(function () {
                    var id = this.id;
                    submitData('getresults', { 'id': id })
                });
            });
        }
    })

    socket.on('deleted', function (data) {
        console.log('Record deleted: ', data.id);
        $('tr#' + data.id).remove();
    })

    socket.on('saved_configlist', function (data) {
        console.log('Configlist saved: ', data);
        $("#configlist").append("<option size=25 value='" + data._id + "'>" + data.cfglist_name + "</option>");
        $(document).ready(function () {
            init_config_lists_caption(data);
            button_enable($("#delete-btn"));
        })
    })

    socket.on('updated_configlist', function (data) {
        console.log('Configlist updated: ', data);

        $(document).ready(function () {
            $("#configlist_updated").text("");
            $("#configlist_updated").append(data.updated);
        })
    })

    socket.on('deleted_configlist', function (data) {
        console.log('Configlist deleted: ', data);
        $("#configlist option[value='" + data.id + "']").remove();
        $(document).ready(function () {
            configlist_detach();
            init_config_lists_clear_text();
        })
    })

    $("#form_dbs").submit(function () {
        try {
            var args = {};
            var errors = []
            args.dbtype = $("select option:selected").attr("value");

            args.host = (checkField($("#host").val(), 100)) ? $("#host").val() : errors.push('Host can\'t be longer than 100');
            args.dbname = (checkField($("#dbname").val(), 100)) ? $("#dbname").val() : errors.push('DB name can\t be longer than 100');
            args.user = (checkField($("#user").val(), 100)) ? $("#user").val() : errors.push('User can\'t be longer than 100');
            args.pass = (checkField($("#pass").val(), 25)) ? $("#pass").val() : errors.push('Password can\'t be longer than 25');
            args.genfile = $('#genfile').is(':checked') ? true : false;
            args.save = $('#save_task').is(':checked') ? true : false;

            var res = {};
            res.form = 'form_dbs';
            res.args = args;
            if (!lotsoferrors(errors))
                submitData('search_db', res);


            //alert(args);;

        } catch (e) {
            console.log(e.stack);
        } finally {
            return false; // to avoid page reload
        } // to avoid page reload

    })

    function get_selected_components() {
        var result = {
            args: {}, errors: []
        };

        result.args.solution = $("#solution option:selected").attr("value");
        result.args.application_type = $("#application_type option:selected").attr("value");
        result.args.os_type = $("#os_type option:selected").attr("value");
        result.args.release = (checkField($("#release").val(), 10)) ? $("#release").val() : result.errors.push('Release can\'t be longer than 10');
        result.genfile = $('#genfile').is(':checked') ? true : false;
        result.save = $('#save_task').is(':checked') ? true : false;

        return result;
    }

    $("#form_comp").submit(function () {
        try {

            var component = get_selected_components();

            var res = {}
            res = component;
            res.form = 'form_comp';
            
            if (!lotsoferrors(component.errors)) {
                submitData('search', res);

            }

        } catch (e) {
            console.log(e.stack);
        } finally {
            return false; // to avoid page reload
        } // to avoid page reload

    })

    $("#form_tasks").submit(function () {
        try {
            var args = {};
            var errors = []
            args = checkedValues("#form_tasks input:checkbox:checked");



            submitData('deleteresults', args);
            //alert(args);;

        } catch (e) {
            console.log(e.stack);
        } finally {
            return false; // to avoid page reload
        } // to avoid page reload

    })

    $("#form_csv").submit(submit_csv())

    function submit_csv() {
        try {
            var errors = [];
            var res = {};
            var genfile = $('#genfile').is(':checked') ? true : false;
            var save = $('#save_task').is(':checked') ? true : false;
            var create_config_list = $('#hasHeader').is(':checked') ? true : false;

            if (components.length == 0) {
                errors.push('components list is empty');
            }


            if (!lotsoferrors(errors)) {
                res.form = "form_csv";
                res.args = components.file;
                res.components = components.components;
                res.genfile = genfile;
                res.save = save;

                submitData('components', res);

            }
        } catch (e) {
            console.log(e.stack);
        } finally {
            return false;
        }
    }


    $("#form_admin").submit(function () {
        try {
            var args = {};
            args.databases = $("#databases option:selected").attr("value");

            submitData('recreate_view', args);
            //alert(args);;

        } catch (e) {
            console.log(e.stack);
        } finally {
            return false; // to avoid page reload
        } // to avoid page reload

    })

    $("#form_generate").submit(function () {
        try {

        } catch (e) {
            console.log(e.stack);
        } finally {
            return false; // to avoid page reload
        } // to avoid page reload
    })

    $("#addto-cs-event").click(function () {

        var result = get_selected_components();

        var data = [];//get_table_data();

        if (!lotsoferrors(result.errors)) {
            data.push(result.args);

            add_config_list_item(data)

            $(document).ready(function () {
                init_config_lists();
                button_disable($("#delete-btn"), {
                    eval: function () {
                        return ($("#configlist_docid").text().length > 0) ? false : true;
                    }
                });

                button_enable($("#update-btn"), {
                    eval: function () {
                        return ($("#configlist_docid").text().length > 0) ? true : false;
                    }

                });
                editable_setlisteners()


            });

            $("#config_list").visible();
            $('.nav-tabs a[href="#conflist_tab"]').tab('show');

        }
    })

    function done() {
        $('.active_submitter').removeAttr('disabled');
        $(':submit').removeClass('active_submitter');
        $('div #loadBar').invisible();
    }

    function submitData(channel, data) {
        console.log("Sending data to /" + channel + ", " + JSON.stringify(data));
        socket.emit(channel, data);
        $('div #loadBar').visible();
    }


    // function to check length of field content. It compares to desired max length of string and min length of string.
    // in case min length is not defind it compares against 0;

    var checkField = function (text, maxcondition, mincondition) {
        if (!mincondition) {
            var mincondition = 1;
        }

        return (text.length > maxcondition || text.length < mincondition) ? false : true;

    }

    var lotsoferrors = function (errors) {
        var err;
        if (errors instanceof Array) {
            err = errors;
        } else {// object kv pairs
            err = [];
            Object.keys(errors).forEach((k) => {

                err.push('<span class="error">' + k + ':</span> ' + errors[k]);
            })

        }
        if (err.length > 0) {
            $("#form_errors").empty();

            $("#form_errors").append('<div id="errors"><h3>Error!</h3><span onclick="this.parentElement.style.display=\'none\'"  class="w3-button w3-display-topright">X</span></div>');
            var s;
            err.forEach((val) => { $("#errors").append(val + '<br/>') });
            return true;

        } else {
            $("#errors").remove();
            return false;
        }
    }

    var checkedValues = function (name) {
        return $(name).map(function () {
            return this.id;
        }).get();
    }

    function openTab(evt, tabName) {
        var i;
        var x = document.getElementsByClassName("tab");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }

        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < x.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " w3-red";
    }

    /* Generate DOCX from template */

    var Generator = function () { };

    Generator.prototype.generateDocx = function (url, obj) {
        this.loadFile(url, obj, this.createDocx)
    }

    Generator.prototype.loadFile = function (url, obj, callback) {

        var self = this;


        self._obj = obj;
        self.url = url;

        JSZipUtils.getBinaryContent(url, function (error, content) {
            if (error) { throw error };
            var zip = new JSZip(content);
            var doc = new Docxtemplater().loadZip(zip)
            doc.setData(self._obj);

            try {
                // render the document (replace all occurences of {first_name} by John, {last_name} by Doe, ...)
                doc.render()
            }
            catch (error) {
                var e = {
                    message: error.message,
                    name: error.name,
                    stack: error.stack,
                    properties: error.properties,
                }
                console.log(JSON.stringify({ error: e }));
                // The error thrown here contains additional information when logged with JSON.stringify (it contains a property object).
                throw error;
            }

            var out = doc.getZip().generate({
                type: "blob",
                mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            }) //Output the document using Data-URI
            saveAs(out, "output.docx")
        });
    }


    Generator.prototype.createDocx = function (error, content) {
        if (error) { throw error };
        var zip = new JSZip(content);
        var doc = new Docxtemplater().loadZip(zip)
        doc.setData(this._obj);

        try {
            // render the document (replace all occurences of {first_name} by John, {last_name} by Doe, ...)
            doc.render()
        }
        catch (error) {
            var e = {
                message: error.message,
                name: error.name,
                stack: error.stack,
                properties: error.properties,
            }
            console.log(JSON.stringify({ error: e }));
            // The error thrown here contains additional information when logged with JSON.stringify (it contains a property object).
            throw error;
        }

        var out = doc.getZip().generate({
            type: "blob",
            mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        }) //Output the document using Data-URI
        saveAs(out, "output.docx")
    }

    function removeOptions(selectbox) {
        var i;
        for (i = selectbox.options.length - 1; i >= 0; i--) {
            selectbox.remove(i);
        }
    }

    function handleFiles(event) {
        var file = event.target.files[0];
        components.file.name = file.name;
        components.file.size = file.size;
        components.file.mimeType = file.mimeType;
        components.components = [];

        var reader = new LineReader();

        var hasHeader = $('#hasHeader').is(':checked') ? true : false;
        var header = [];


        reader.on('line', function (line, next) {
            // Do something with line....

            if (header.length == 0) {
                header = line.split(',');
                add_header_to_configlist(header);
            } else {

                var array = line.split(',');

                add_row_to_configlist(array);

                var obj = {};
                for (var i = 0; i < array.length; i++) {
                    obj[header[i]] = "" + array[i] + "";
                }
                //components.components.push(obj);

            }


            next(); // Call next to resume...
        });

        reader.on('end', function (evt) {
            console.log(components);

            // initialize config list buttons
            $("#configlist_name").text('');
            $("#configlist_docid").text('');
            $("#configlist_revid").text('');
            $("#configlist_time").text('');
            $("#configlist_updated").text('');

            $(document).ready(function () {
                init_config_lists();
                button_disable($("#delete-btn"));
                editable_setlisteners()


            });

            $("#config_list").visible();
            $('.nav-tabs a[href="#conflist_tab"]').tab('show');

        })

        reader.read(file);
    }

    function add_row_to_configlist(data) {
        console.log('Got item for config list');
        if (data instanceof Array) {
            var row = '';
            data.forEach((item) => {

                row = row + '<td contenteditable="true">' + normalizeConfigListItem(item) + '</td>';

            })
            $('#config_list_t').append('<tr>' + row
                + '<td><span class="table-remove glyphicon glyphicon-remove"></span></td>'
                + '<td><span class="table-up glyphicon glyphicon-arrow-up"></span>'
                + '<span class="table-down glyphicon glyphicon-arrow-down"></span>'
                + '</td></tr>');


        }
    }

    function normalizeConfigListItem(item) {//remove " if the string is wrapped into double qoutes
        if (item instanceof String) {
            if (item.startsWith('"') && item.endsWith('"')) {
                return item.substring(1, item.length - 1);
            }
        }
        return item;
    }
    function configlist_detach() {
        $('#config_list').detach();
        $('#export_div').detach();
        console.log("export_div detached");
    }
    function add_header_to_configlist(data) {
        console.log('Got header item for config list');

        configlist_detach();

        $('#configlist_container').append(
            '<div id="config_list" class="table-editable" style="visibility: hidden">'
            + '<span class="table-add glyphicon glyphicon-plus"></span>'
            + '<table id="config_list_t" class="table">'
            + '<tr id="config_list_t_header">'
            + '</tr>'
            + '<!-- This is our clonable table line -->'
            + '</table>'
            + '</div>'
        );
        if (data instanceof Array) {
            var row = '';
            data.forEach((item) => {

                row = row + '<th>' + normalizeConfigListItem(item) + '</th>';

            })
            $('#config_list_t_header').append(row + '<th></th><th></th>');

            /*
                        $("#configlist_container").append('<div id="export_div">'
                            + '<button id="run-btn" class="btn btn-primary">Run</button>'
                            + '<button id="save-btn" class="btn btn-primary">Save as</button>'
                            + '<button id="update-btn" class="btn btn-primary" disabled="true">Update</button>'
                            + '<button id="delete-btn" class="btn btn-primary">Delete</button>'
                            + '<button id="reset-btn" class="btn btn-primary">Reset</button><p id="export"></p></div>');
            */
            /*
            $(document).ready(function () {
               init_config_lists();
            });
            */
        }
    }

    // Configuration lists table management script 

    function init_config_lists_clear_text() {

        $("#configlist_name").text('');
        $("#configlist_docid").text('');
        $("#configlist_revid").text('');
        $("#configlist_time").text('');
        $("#configlist_updated").text('');
    }


    function init_config_lists_caption(data) {

        init_config_lists_clear_text();

        $("#configlist_name").append(data.cfglist_name);
        $("#configlist_docid").append(data._id);
        $("#configlist_revid").append(data._rev);
        $("#configlist_time").append(data.time);
        $("#configlist_updated").append(data.updated);
    }

    function button_enable(elem, condition) {
        console.log(elem + " is enabled")
        if (condition) {
            if (condition.eval()) {
                elem.prop("disabled", false)
            }
            return
        }
        elem.prop("disabled", false);
    }

    // condition is an object where eval is a user defined function to evaluate true/false condition to disable an object

    function button_disable(elem, condition) {
        console.log(elem + " is disabled")
        if (condition) {
            if (condition.eval()) {
                elem.prop("disabled", true)
            }
            return
        }

        elem.prop("disabled", true)
    }

    function get_table_data() {
        var $TABLE = $('#config_list_t');

        var $rows = $TABLE.find('tr:not(:hidden)');
        var headers = [];
        var data = [];

        // Get the headers (add special header logic here)

        if ($rows.length > 1) {
            $($rows.shift()).find('th:not(:empty)').each(function () {
                headers.push($(this).text().toUpperCase());
            });

            // Turn all existing rows into a loopable array
            $rows.each(function () {
                var $td = $(this).find('td');
                var h = {};

                // Use the headers from earlier to name our hash keys
                headers.forEach(function (header, i) {
                    h[header] = $td.eq(i).text();
                });

                data.push(h);
            });
        }

        return data;

    }

    function set_cl_table_button_listeners() {

        var exp_div = $("#configlist_container").find("#export_div");


        if (exp_div.length != 0) {
            var $TABLE = $('#config_list_t');
            var $BTN = $('#run-btn');
            var $BTN_SAVE = $('#save-btn');
            var $BTN_UPDATE = $('#update-btn');
            var $BTN_DELETE = $('#delete-btn');
            var $BTN_RESET = $('#reset-btn');
            var $EXPORT = $('#export');

            $('.table-add').click(function () {
                var $clone = $TABLE.find('tr.hide').clone(true).removeClass('hide table-line');
                $TABLE.find('table').append($clone);
                button_enable($BTN_UPDATE);
            });

            $('.table-remove').click(function () {
                $(this).parents('tr').detach();
                button_enable($BTN_UPDATE);
            });

            $('.table-up').click(function () {
                var $row = $(this).parents('tr');
                if ($row.index() === 1) return; // Don't go above the header
                $row.prev().before($row.get(0));
                button_enable($BTN_UPDATE);
            });

            $('.table-down').click(function () {
                var $row = $(this).parents('tr');
                $row.next().after($row.get(0));
                button_enable($BTN_UPDATE);
            });

            // A few jQuery helpers for exporting only
            jQuery.fn.pop = [].pop;
            jQuery.fn.shift = [].shift;
        }
    }

    function init_config_lists() {

        console.log('init_config_lists is entered. Checking initialization preconditions')

        var exp_div = $("#configlist_container").find("#export_div");


        if (exp_div.length == 0) {

            console.log('init_config_lists is not initialized. Initializing ...');

            $("#configlist_container").append('<div id="export_div">'
                + '<button id="run-btn" class="btn btn-primary">Run</button>'
                + '<button id="save-btn" class="btn btn-primary">Save as</button>'
                + '<button id="update-btn" class="btn btn-primary" disabled="true">Update</button>'
                + '<button id="delete-btn" class="btn btn-primary">Delete</button>'
                + '<button id="reset-btn" class="btn btn-primary">Reset</button><p id="export"></p></div>');


            var $TABLE = $('#config_list_t');
            var $BTN = $('#run-btn');
            var $BTN_SAVE = $('#save-btn');
            var $BTN_UPDATE = $('#update-btn');
            var $BTN_DELETE = $('#delete-btn');
            var $BTN_RESET = $('#reset-btn');
            var $EXPORT = $('#export');

            $BTN.click(function () {

                console.log('Configuration list is to be sent to backend for evaluation')

                var data = get_table_data();

                var cl = {
                    cfglist_name: $("#configlist_name").text(),
                    _id: $("#configlist_docid").text(),
                    _rev: $("#configlist_revid").text(),
                    time: $("#configlist_time").text()
                }

                if (cl._id.length > 0) {
                    components.file = cl;
                }


                // Output the result
                console.log(data);
                components.components = data;
                $(this).addClass("active_submitter");
                $('.nav_tab a#result_tab').tab('show');
                submit_csv();

            });

            $BTN_SAVE.click(function () {

                console.log('Saving config list');
                var data = get_table_data();
                $('#configlist_modal').data("components", data)
                $('#configlist_modal').modal('show');

            })

            $BTN_UPDATE.click(function () {

                var cl = {
                    cfglist_name: $("#configlist_name").text(),
                    _id: $("#configlist_docid").text(),
                    _rev: $("#configlist_revid").text(),
                    time: $("#configlist_time").text()
                }

                console.log('Updating config list: ' + cl.cfglist_name + ' _id:' + cl._id + ' _rev: ' + cl._rev);
                console.log('Updating config list');
                cl.components = get_table_data();

                $('#configlist_update_modal').data("document", cl)

                $('#configlist_update_modal').modal('show');

            })

            $BTN_DELETE.click(function () {

                var cl = {
                    name: $("#configlist_name"),
                    id: $("#configlist_docid")
                }

                cl.name;

                console.log('Deleting config list: ' + cl.name.text() + ' _id:' + cl.id.text());

                $('#configlist_delete_modal').data("id", cl.id.text())
                $('#configlist_delete_modal').modal('show');

            })

            $BTN_RESET.click(function () {
                if (!$("#update-btn").prop("disabled")) {
                    $('#configlist_forced_update_modal').modal('show');

                } else {
                    $("#reset-event").click()
                }
            })



        }
        set_cl_table_button_listeners(); // set button listeners regardless to handle the case of added rows to existing configlist
    }

    // Handling of config list modal  buttons
    $('#save-event').on(
        'click',
        function (evt) {
            console.log('Saving of config list has been triggered');
            var errors = [];
            var args = {};

            var modal_data = $('#configlist_modal').data();
            var cfglist_name = $("#configlist-name").val();

            args.cfglist_name = (checkField($("#configlist-name").val(), 20)) ? $("#configlist-name").val() : errors.push('Configuration list name is too long, can\'t be longer than 20');
            args.components = modal_data.components;

            if (!lotsoferrors(errors)) {

                submitData('save_configlist', args);
                $('#save-btn').addClass("active_submitter");
            }

            $('#configlist_modal').modal('hide');


        }
    );

    $("#update-event").on(
        'click',
        function (evt) {
            console.log('Update of config list has been triggered');

            var data = $('#configlist_update_modal').data();

            submitData('update_configlist', data.document);
            $('#configlist_update_modal').modal('hide');
            $('#update-btn').addClass("active_submitter");
        }
    )

    $("#delete-event").on(
        'click',
        function (evt) {
            console.log('Deleting of config list has been triggered');

            var id = $('#configlist_delete_modal').data('id');
            submitData('delete_configlist', id);
            $('#configlist_delete_modal').modal('hide');
            $('#delete-btn').addClass("active_submitter");
        }
    )

    $("#forced-update-event").on('click',
        function (evt) {
            var queue = new function_pipeline();
            console.log('Forced update of config list has been triggered');
            $('#configlist_forced_update_modal').modal('hide');
            if ($("#configlist_docid").text.length > 0) {
                queue.push(function () { $('#save-btn').click() });
            } else {
                queue.push(function () { $('#update-btn').click() });
            }
            queue.push(function () { $('#reset-event').click() });

            queue.execute();



        })
    $("#reset-event").on('click',
        function (evt) {
            init_config_lists_clear_text();
            configlist_detach();
        })

    $("#get-statdata-event").on('click',
        function (evt) {
            submitData('get_rn_statdata', {});
        })



    // Scripts to handle TABs

    var function_pipeline = function () {
        this.queue = []
    }

    function_pipeline.prototype.push = function (arg) {
        this.queue.push(arg)
    }

    function_pipeline.prototype.execute = function () {
        while (this.queue.length) {
            this.queue.shift().call();
        }
    }


    $('.nav-tabs a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
    });

</script>

			</div>
		</div>
		<div id="form_errors"></div>





	</section>



</body>

</html>